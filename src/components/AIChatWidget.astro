---
// AI Chat Widget Component
interface Props {
  customerName?: string;
}

const { customerName = 'Klient' } = Astro.props;

// Predefined quick actions and FAQs
const quickActions = [
  { id: 'status', label: 'Stav zÃ¡kazky', icon: 'ğŸ“¦' },
  { id: 'deadline', label: 'TermÃ­ny', icon: 'ğŸ“…' },
  { id: 'quote', label: 'CenovÃ¡ ponuka', icon: 'ğŸ’°' },
  { id: 'contact', label: 'Kontakt', icon: 'ğŸ“' },
];

const faqs = [
  { 
    question: 'AkÃ© sÃº termÃ­ny dodania?', 
    answer: 'Å tandardnÃ¡ doba dodania je 5-7 pracovnÃ½ch dnÃ­. Pri expresnÃ½ch zÃ¡kazkÃ¡ch 2-3 dni.' 
  },
  { 
    question: 'AkÃ© formÃ¡ty sÃºborov prijÃ­mate?', 
    answer: 'PrijÃ­mame PDF, AI, EPS, PSD vo vysokom rozlÃ­Å¡enÃ­ (min. 150 DPI pre veÄ¾koformÃ¡t).' 
  },
  { 
    question: 'Ako mÃ´Å¾em zmeniÅ¥ grafiku na billboarde?', 
    answer: 'Kontaktujte nÃ¡s emailom na info@adsun.sk s novou grafikou. VÃ½mena trvÃ¡ 2-3 dni.' 
  },
];
---

<!-- AI Chat Toggle Button -->
<button 
  id="chatToggle"
  class="fixed bottom-6 right-6 md:bottom-8 md:right-8 w-14 h-14 bg-gradient-to-br from-[#f59e0b] to-[#d97706] rounded-full shadow-lg shadow-[#f59e0b]/30 flex items-center justify-center z-50 hover:scale-110 transition-transform"
  aria-label="OtvoriÅ¥ chat"
>
  <svg id="chatIcon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0a0a0a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
  </svg>
  <svg id="closeIcon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0a0a0a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"/>
    <line x1="6" y1="6" x2="18" y2="18"/>
  </svg>
</button>

<!-- Chat Panel -->
<div 
  id="chatPanel"
  class="fixed bottom-24 right-6 md:bottom-28 md:right-8 w-[calc(100%-3rem)] md:w-96 max-h-[70vh] bg-[#111111] border border-[#2a2a2a] rounded-2xl shadow-2xl z-50 hidden flex-col overflow-hidden"
>
  <!-- Header -->
  <div class="bg-gradient-to-r from-[#f59e0b] to-[#d97706] p-4">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-[#0a0a0a]/20 rounded-full flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
      </div>
      <div>
        <h3 class="font-semibold text-[#0a0a0a]">ADSUN Asistent</h3>
        <p class="text-xs text-[#0a0a0a]/70">Ako vÃ¡m mÃ´Å¾em pomÃ´cÅ¥?</p>
      </div>
    </div>
  </div>
  
  <!-- Chat Messages -->
  <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4 max-h-80">
    <!-- Welcome message -->
    <div class="flex gap-3">
      <div class="w-8 h-8 bg-[#f59e0b]/20 rounded-full flex items-center justify-center flex-shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42"/>
        </svg>
      </div>
      <div class="flex-1">
        <div class="bg-[#1a1a1a] rounded-2xl rounded-tl-none p-3 text-sm text-white">
          DobrÃ½ deÅˆ! ğŸ‘‹ Som vÃ¡Å¡ ADSUN asistent. MÃ´Å¾em vÃ¡m pomÃ´cÅ¥ s:
          <ul class="mt-2 space-y-1 text-[#9ca3af]">
            <li>â€¢ InformÃ¡ciami o zÃ¡kazkÃ¡ch</li>
            <li>â€¢ TermÃ­nmi a cenami</li>
            <li>â€¢ Radami pre tlaÄ a polepy</li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="flex flex-wrap gap-2">
      {quickActions.map(action => (
        <button 
          class="quick-action px-3 py-2 bg-[#1a1a1a] hover:bg-[#2a2a2a] border border-[#333] hover:border-[#f59e0b] rounded-lg text-sm text-white transition-all flex items-center gap-2"
          data-action={action.id}
        >
          <span>{action.icon}</span>
          <span>{action.label}</span>
        </button>
      ))}
    </div>
  </div>
  
  <!-- FAQ Section -->
  <div id="faqSection" class="border-t border-[#2a2a2a] p-4">
    <p class="text-xs text-[#6b7280] mb-3">ÄŒastÃ© otÃ¡zky:</p>
    <div class="space-y-2">
      {faqs.map((faq, i) => (
        <button 
          class="faq-btn w-full text-left px-3 py-2 bg-[#1a1a1a] hover:bg-[#2a2a2a] rounded-lg text-xs text-[#9ca3af] hover:text-white transition-all"
          data-answer={faq.answer}
        >
          {faq.question}
        </button>
      ))}
    </div>
  </div>
  
  <!-- Input -->
  <div class="border-t border-[#2a2a2a] p-4">
    <form id="chatForm" class="flex gap-2">
      <input 
        type="text" 
        id="chatInput"
        placeholder="NapÃ­Å¡te sprÃ¡vu..."
        class="flex-1 bg-[#1a1a1a] border border-[#333] rounded-lg px-4 py-2 text-sm text-white placeholder-[#6b7280] focus:border-[#f59e0b] focus:outline-none"
      />
      <button 
        type="submit"
        class="w-10 h-10 bg-[#f59e0b] hover:bg-[#fbbf24] rounded-lg flex items-center justify-center transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#0a0a0a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
      </button>
    </form>
  </div>
</div>

<script>
  const chatToggle = document.getElementById('chatToggle');
  const chatPanel = document.getElementById('chatPanel');
  const chatIcon = document.getElementById('chatIcon');
  const closeIcon = document.getElementById('closeIcon');
  const chatMessages = document.getElementById('chatMessages');
  const chatForm = document.getElementById('chatForm');
  const chatInput = document.getElementById('chatInput') as HTMLInputElement;
  
  let isOpen = false;
  
  // Toggle chat
  chatToggle?.addEventListener('click', () => {
    isOpen = !isOpen;
    chatPanel?.classList.toggle('hidden', !isOpen);
    chatPanel?.classList.toggle('flex', isOpen);
    chatIcon?.classList.toggle('hidden', isOpen);
    closeIcon?.classList.toggle('hidden', !isOpen);
  });
  
  // Add message to chat
  function addMessage(content: string, isUser: boolean = false) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `flex gap-3 ${isUser ? 'flex-row-reverse' : ''}`;
    
    const avatar = isUser 
      ? `<div class="w-8 h-8 bg-[#333] rounded-full flex items-center justify-center flex-shrink-0">
           <span class="text-xs font-bold text-white">Vy</span>
         </div>`
      : `<div class="w-8 h-8 bg-[#f59e0b]/20 rounded-full flex items-center justify-center flex-shrink-0">
           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
             <circle cx="12" cy="12" r="3"/><path d="M12 1v2"/>
           </svg>
         </div>`;
    
    const bubbleClass = isUser 
      ? 'bg-[#f59e0b] text-[#0a0a0a] rounded-2xl rounded-tr-none'
      : 'bg-[#1a1a1a] text-white rounded-2xl rounded-tl-none';
    
    messageDiv.innerHTML = `
      ${avatar}
      <div class="flex-1 ${isUser ? 'flex justify-end' : ''}">
        <div class="${bubbleClass} p-3 text-sm max-w-[85%] ${isUser ? 'inline-block' : ''}">${content}</div>
      </div>
    `;
    
    chatMessages?.appendChild(messageDiv);
    chatMessages?.scrollTo({ top: chatMessages.scrollHeight, behavior: 'smooth' });
  }
  
  // AI responses based on keywords
  function getAIResponse(message: string): string {
    const lower = message.toLowerCase();
    
    if (lower.includes('stav') || lower.includes('zÃ¡kazk') || lower.includes('objednÃ¡vk')) {
      return 'Pre aktuÃ¡lny stav vaÅ¡ich zÃ¡kaziek navÅ¡tÃ­vte sekciu <strong>"Moje zÃ¡kazky"</strong> na dashboarde. Tam nÃ¡jdete prehÄ¾ad vÅ¡etkÃ½ch aktÃ­vnych aj dokonÄenÃ½ch zÃ¡kaziek. ğŸ“¦';
    }
    
    if (lower.includes('termÃ­n') || lower.includes('dodanie') || lower.includes('kedy')) {
      return 'Å tandardnÃ¡ doba dodania je <strong>5-7 pracovnÃ½ch dnÃ­</strong>. Pri expresnÃ½ch zÃ¡kazkÃ¡ch <strong>2-3 dni</strong>. KonkrÃ©tny termÃ­n nÃ¡jdete v detaile vaÅ¡ej zÃ¡kazky. â°';
    }
    
    if (lower.includes('cen') || lower.includes('ponuk') || lower.includes('koÄ¾ko')) {
      return 'AktuÃ¡lne cenovÃ© ponuky nÃ¡jdete v sekcii <strong>"CenovÃ© ponuky"</strong>. Pre novÃº ponuku nÃ¡s kontaktujte na <a href="tel:+421903222751" class="text-[#f59e0b]">+421 903 222 751</a>. ğŸ’°';
    }
    
    if (lower.includes('tlaÄ') || lower.includes('print') || lower.includes('formÃ¡t')) {
      return 'ğŸ–¨ï¸ <strong>Tipy pre tlaÄ:</strong><br>â€¢ RozlÃ­Å¡enie min. 150 DPI pre veÄ¾koformÃ¡t<br>â€¢ FormÃ¡ty: PDF, AI, EPS, PSD<br>â€¢ CMYK farebnÃ½ priestor<br>â€¢ 3mm spadÃ¡vka pre orez';
    }
    
    if (lower.includes('polep') || lower.includes('vozidl') || lower.includes('auto')) {
      return 'ğŸš— <strong>Polepy vozidiel:</strong><br>â€¢ PouÅ¾ite vektorovÃº grafiku<br>â€¢ PoÄÃ­tajte s krivkami karosÃ©rie<br>â€¢ Å½ivotnosÅ¥ 5-7 rokov<br>â€¢ MoÅ¾nosÅ¥ ÄiastoÄnÃ©ho aj celopolepenia';
    }
    
    if (lower.includes('svetel') || lower.includes('reklam') || lower.includes('led') || lower.includes('neon')) {
      return 'ğŸ’¡ <strong>SvetelnÃ¡ reklama:</strong><br>â€¢ LED technolÃ³gia - ÃºspornÃ¡<br>â€¢ MoÅ¾nosÅ¥ programovateÄ¾nÃ½ch efektov<br>â€¢ Å½ivotnosÅ¥ 50 000+ hodÃ­n<br>â€¢ VonkajÅ¡ie aj vnÃºtornÃ© pouÅ¾itie';
    }
    
    if (lower.includes('billboard')) {
      return 'ğŸª§ MÃ¡me 60+ billboardov v okolÃ­ Pezinka a Bratislavy. Pozrite si dostupnÃ© lokality v sekcii <strong>"Billboardy"</strong> alebo na <a href="https://adsun.sk/billboardy" class="text-[#f59e0b]" target="_blank">adsun.sk/billboardy</a>';
    }
    
    if (lower.includes('kontakt') || lower.includes('telefÃ³n') || lower.includes('email')) {
      return 'ğŸ“ <strong>Kontaktujte nÃ¡s:</strong><br>Tel: <a href="tel:+421903222751" class="text-[#f59e0b]">+421 903 222 751</a><br>Email: <a href="mailto:info@adsun.sk" class="text-[#f59e0b]">info@adsun.sk</a><br>Adresa: Pezinok';
    }
    
    if (lower.includes('body') || lower.includes('odmena') || lower.includes('zÄ¾ava') || lower.includes('vernost')) {
      return 'â­ <strong>ADSUN Rewards:</strong><br>Za kaÅ¾dÃº zÃ¡kazku zÃ­skavate body! Sledujte svoj stav na dashboarde. Viac bodov = vÃ¤ÄÅ¡ie zÄ¾avy a vÃ½hody. ğŸ';
    }
    
    return 'Äakujem za vaÅ¡u sprÃ¡vu! Pre konkrÃ©tne informÃ¡cie ma mÃ´Å¾ete spÃ½taÅ¥ na:<br>â€¢ Stav zÃ¡kazky<br>â€¢ TermÃ­ny dodania<br>â€¢ Tipy pre tlaÄ/polepy<br>â€¢ CenovÃ© ponuky<br><br>Alebo nÃ¡s kontaktujte na <a href="tel:+421903222751" class="text-[#f59e0b]">+421 903 222 751</a> ğŸ“';
  }
  
  // Handle form submit
  chatForm?.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = chatInput?.value.trim();
    if (!message) return;
    
    addMessage(message, true);
    chatInput.value = '';
    
    // Simulate typing
    setTimeout(() => {
      addMessage(getAIResponse(message));
    }, 500);
  });
  
  // Quick actions
  document.querySelectorAll('.quick-action').forEach(btn => {
    btn.addEventListener('click', () => {
      const action = btn.getAttribute('data-action');
      let query = '';
      switch(action) {
        case 'status': query = 'AkÃ½ je stav mojej zÃ¡kazky?'; break;
        case 'deadline': query = 'AkÃ© sÃº termÃ­ny dodania?'; break;
        case 'quote': query = 'Potrebujem cenovÃº ponuku'; break;
        case 'contact': query = 'Ako vÃ¡s mÃ´Å¾em kontaktovaÅ¥?'; break;
      }
      if (query) {
        addMessage(query, true);
        setTimeout(() => addMessage(getAIResponse(query)), 500);
      }
    });
  });
  
  // FAQ buttons
  document.querySelectorAll('.faq-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const question = btn.textContent?.trim() || '';
      const answer = btn.getAttribute('data-answer') || '';
      addMessage(question, true);
      setTimeout(() => addMessage(answer), 500);
    });
  });
</script>

<style>
  #chatPanel {
    animation: slideUp 0.3s ease-out;
  }
  
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
