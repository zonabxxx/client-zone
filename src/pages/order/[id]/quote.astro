---
import Layout from '../../../layouts/Layout.astro';
import DashboardHeader from '../../../components/DashboardHeader.astro';
import { getSessionFromCookie } from '../../../lib/session';
import { getOrderById, getQuoteProducts, canCustomerAccessOrder, getCalculationShareLink, getCalculationProductDimensions, getCalculationById, getCalculationProducts, getCalculationActivities } from '../../../lib/db';
import { format } from 'date-fns';
import { sk } from 'date-fns/locale';

// Check authentication
const session = getSessionFromCookie(Astro.request.headers.get('cookie'));

if (!session) {
  return Astro.redirect('/');
}

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/dashboard');
}

// Verify access
const hasAccess = await canCustomerAccessOrder(session.customerId, session.customerName, id);
if (!hasAccess) {
  return Astro.redirect('/dashboard');
}

// Fetch order data
const order = await getOrderById(id);

if (!order) {
  return Astro.redirect('/dashboard');
}

// Get products from calculation EAV (preferred - has correct prices)
let products = await getCalculationProducts(order.calculationId);

// Fallback to order_services if no calculation products
if (products.length === 0) {
  products = await getQuoteProducts(id, order.name);
  
  // Get product dimensions from calculation EAV if not already present
  const calcDimensions = await getCalculationProductDimensions(order.calculationId);
  
  // Merge dimensions from calculation into products
  if (calcDimensions.size > 0) {
    products = products.map(product => {
      if (!product.dimensions && calcDimensions.has(product.id)) {
        return { ...product, dimensions: calcDimensions.get(product.id) };
      }
      return product;
    });
    
    if (products.length === 1 && !products[0].dimensions && calcDimensions.size > 0) {
      const firstDimensions = calcDimensions.values().next().value;
      if (firstDimensions) {
        products[0] = { ...products[0], dimensions: firstDimensions };
      }
    }
  }
}

// Get calculation share link if exists
const shareLink = await getCalculationShareLink(order.calculationId);

// If share link exists, redirect to the public quote page (has correct language, VAT, materials)
if (shareLink?.shareToken && shareLink?.calculationId) {
  return Astro.redirect(`/quote/${shareLink.calculationId}/${shareLink.shareToken}`);
}

// Get actual approval status from calculation (not from order status)
const calculation = order.calculationId ? await getCalculationById(order.calculationId) : null;
const approvalStatus = calculation?.approvalStatus || 'DRAFT';

// Get client request message from calculation data
const clientRequestMessage = calculation?.calculationData?.clientRequestMessage || null;
const isWaitingForClient = approvalStatus === 'WAITING_FOR_CLIENT';

// Get communication history (questions/answers)
const activities = order.calculationId ? await getCalculationActivities(order.calculationId) : [];
const communicationActivities = activities.filter(a => 
  a.action === 'question_received' || 
  a.action === 'client_requested_changes' ||
  a.action === 'client_approved' ||
  a.action === 'client_rejected'
);

// Approval status config
const statusConfig: Record<string, { label: string; color: string; bgColor: string; icon: string }> = {
  'DRAFT': { label: 'V pr√≠prave', color: 'text-slate-400', bgColor: 'bg-slate-500/20', icon: 'üìù' },
  'CLIENT_VIEWED': { label: 'ƒåak√° na schv√°lenie', color: 'text-amber-400', bgColor: 'bg-amber-500/20', icon: '‚è≥' },
  'CLIENT_APPROVED': { label: 'Schv√°len√©', color: 'text-emerald-400', bgColor: 'bg-emerald-500/20', icon: '‚úÖ' },
  'CLIENT_REJECTED': { label: 'Zamietnut√©', color: 'text-red-400', bgColor: 'bg-red-500/20', icon: '‚ùå' },
  'CLIENT_REQUESTED_CHANGES': { label: 'Po≈æadovan√© zmeny', color: 'text-orange-400', bgColor: 'bg-orange-500/20', icon: '‚úèÔ∏è' },
  'WAITING_FOR_CLIENT': { label: 'ƒåak√° na V√°s', color: 'text-amber-400', bgColor: 'bg-amber-500/20', icon: '‚è≥' },
};
const currentStatus = statusConfig[approvalStatus] || statusConfig['DRAFT'];
const isApproved = approvalStatus === 'CLIENT_APPROVED';

// Determine back URL based on where user came from
const fromParam = Astro.url.searchParams.get('from');
const backUrl = fromParam === 'quotes' ? '/quotes' : `/order/${id}`;
const backLabel = fromParam === 'quotes' ? 'Sp√§≈• na cenov√© ponuky' : 'Sp√§≈• na z√°kazku';

// Calculate totals - prices are WITHOUT VAT
const vatRate = 23; // 23% DPH
const subtotal = Math.round(products.reduce((sum, p) => sum + (p.totalPrice || 0), 0) * 100) / 100;
const vatAmount = Math.round(subtotal * (vatRate / 100) * 100) / 100;
const totalWithVat = Math.round((subtotal + vatAmount) * 100) / 100;

function formatDate(date: Date | number | null): string {
  if (!date) return '‚Äî';
  try {
    const d = typeof date === 'number' ? new Date(date) : new Date(date);
    return format(d, 'd. MMMM yyyy', { locale: sk });
  } catch {
    return '‚Äî';
  }
}
---

<Layout title={`Cenov√° ponuka - ${order.name}`}>
  <main class="min-h-screen">
    <DashboardHeader customerName={session.customerName} />
    
    <div class="max-w-3xl mx-auto px-3 sm:px-4 py-4 sm:py-8">
      <!-- Back button -->
      <a href={backUrl} class="inline-flex items-center gap-1.5 sm:gap-2 text-slate-400 hover:text-white transition-colors mb-4 sm:mb-6 text-sm sm:text-base">
        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        {backLabel}
      </a>

      <!-- Quote header -->
      <div class:list={[
        "rounded-2xl sm:rounded-3xl p-4 sm:p-8 mb-4 sm:mb-6 animate-fade-in-up",
        isApproved ? "bg-emerald-500/10 border-2 border-emerald-500/30" : "glass"
      ]}>
        <div class="text-center mb-6 sm:mb-8">
          <div class="flex flex-wrap items-center justify-center gap-1.5 sm:gap-2 mb-3 sm:mb-4">
            <div class="inline-flex items-center gap-1.5 sm:gap-2 px-2.5 sm:px-4 py-1.5 sm:py-2 bg-blue-500/20 rounded-full text-blue-400 text-xs sm:text-sm font-medium">
              <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Cenov√° ponuka
            </div>
            <div class={`inline-flex items-center gap-1.5 sm:gap-2 px-2.5 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium ${currentStatus.bgColor} ${currentStatus.color}`}>
              <span>{currentStatus.icon}</span>
              {currentStatus.label}
            </div>
          </div>
          <h1 class="text-lg sm:text-2xl md:text-3xl font-bold text-white mb-1 sm:mb-2 px-2 break-words hyphens-auto leading-tight">{order.name}</h1>
          <p class="text-slate-400 text-sm sm:text-base">ƒå√≠slo: {order.orderNumber}</p>
          
          {isApproved && (
            <div class="mt-3 sm:mt-4 inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-emerald-500/20 rounded-full text-emerald-400 text-xs sm:text-sm">
              <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              <span class="hidden sm:inline">T√°to ponuka bola schv√°len√°. Z√°kazka je v realiz√°cii.</span>
              <span class="sm:hidden">Schv√°len√© - v realiz√°cii</span>
            </div>
          )}

          {/* Waiting for Client - Request Message */}
          {isWaitingForClient && clientRequestMessage && (
            <div class="mt-4 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl text-left">
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <h4 class="text-amber-400 font-semibold text-sm mb-1">Potrebujeme od V√°s</h4>
                  <p class="text-slate-400 text-xs mb-2">Pros√≠m dodajte nasledovn√© √∫daje:</p>
                  <div class="bg-slate-800/50 rounded-lg p-3 text-white whitespace-pre-wrap text-sm">
                    {clientRequestMessage}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
        
        {/* Response form when waiting for client - INSTEAD of quote details */}
        {isWaitingForClient && (
          <div class="glass-light rounded-xl p-4 sm:p-6 mb-6">
            <form method="POST" action={`/api/quote/${calculation?.id || order.calculationId}/respond-waiting`}>
              <div class="space-y-4">
                <div class="flex items-center gap-2 text-amber-400 mb-2">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm font-medium">Va≈°a odpoveƒè</span>
                </div>
                <textarea
                  name="comment"
                  rows="4"
                  class="w-full border-2 border-amber-500/50 bg-slate-800/50 rounded-xl px-4 py-3 text-sm text-white placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                  placeholder="Nap√≠≈°te odpoveƒè alebo prilo≈æte po≈æadovan√© s√∫bory..."
                ></textarea>
                <button
                  type="submit"
                  class="w-full py-4 rounded-xl text-lg font-bold text-slate-900 bg-gradient-to-r from-amber-400 to-amber-500 hover:from-amber-500 hover:to-amber-600 shadow-lg shadow-amber-500/20 transition-all duration-200 flex items-center justify-center gap-2"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                  </svg>
                  Odosla≈• odpoveƒè
                </button>
              </div>
            </form>
          </div>
        )}

        {/* Quote details - hidden when waiting for client */}
        {!isWaitingForClient && (
          <>
            <!-- Quote info -->
            <div class="grid grid-cols-2 gap-3 sm:gap-4 text-xs sm:text-sm mb-6 sm:mb-8 pb-6 sm:pb-8 border-b border-slate-700/50">
              <div>
                <div class="text-slate-400 mb-0.5 sm:mb-1">D√°tum vytvorenia</div>
                <div class="text-white font-medium">{formatDate(order.createdAt)}</div>
              </div>
              <div>
                <div class="text-slate-400 mb-0.5 sm:mb-1">Platnos≈• do</div>
                <div class="text-white font-medium">{formatDate(order.plannedEndDate)}</div>
              </div>
            </div>
          </>
        )}

        {!isWaitingForClient && (
          <>
            <!-- Products section -->
        {products.length > 0 && (
          <div class="mb-6 sm:mb-8">
            <div class="flex items-center gap-2 mb-3 sm:mb-4">
              <span class="w-6 h-6 sm:w-8 sm:h-8 bg-emerald-500/20 rounded-lg flex items-center justify-center">
                <svg class="w-3 h-3 sm:w-4 sm:h-4 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z" />
                  <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" />
                </svg>
              </span>
              <span class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider">Produkty</span>
            </div>
            
            <div class="space-y-2 sm:space-y-3">
              {products.map((product) => (
                <div class="glass-light rounded-lg sm:rounded-xl p-3 sm:p-4">
                  <div class="flex justify-between items-start gap-2">
                    <div class="flex-1 min-w-0">
                      <div class="text-white font-semibold text-sm sm:text-lg break-words leading-snug">{product.name}</div>
                      <div class="text-xs sm:text-sm text-slate-400 mt-0.5 sm:mt-1">
                        √ó {product.quantity.toLocaleString('sk-SK', { maximumFractionDigits: 2 })} {product.unit}
                      </div>
                    </div>
                    <div class="text-right flex-shrink-0">
                      <div class="text-base sm:text-xl font-bold text-emerald-400">
                        {product.totalPrice.toLocaleString('sk-SK', { minimumFractionDigits: 0 })} ‚Ç¨
                      </div>
                    </div>
                  </div>
                  
                  {/* Product dimensions / sticker details */}
                  {product.dimensions && product.dimensions.length > 0 && (
                    <div class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-slate-700/50">
                      <div class="text-[10px] sm:text-xs text-slate-500 uppercase tracking-wider mb-1.5 sm:mb-2">Rozmery</div>
                      <div class="grid gap-1.5 sm:gap-2">
                        {product.dimensions.map((dim, idx) => (
                          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between bg-slate-800/50 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm gap-1 sm:gap-0">
                            <div class="flex items-center gap-2 sm:gap-3">
                              <span class="w-5 h-5 sm:w-6 sm:h-6 bg-blue-500/20 text-blue-400 rounded flex items-center justify-center text-[10px] sm:text-xs font-bold flex-shrink-0">
                                {idx + 1}
                              </span>
                              <span class="text-white text-xs sm:text-sm">{dim.name || `Polo≈æka ${idx + 1}`}</span>
                            </div>
                            <div class="flex items-center gap-2 sm:gap-4 text-slate-300 ml-7 sm:ml-0">
                              <span class="flex items-center gap-0.5 sm:gap-1">
                                <span class="text-slate-500">≈°:</span>
                                <span class="font-medium">{dim.width}</span>
                              </span>
                              <span class="flex items-center gap-0.5 sm:gap-1">
                                <span class="text-slate-500">v:</span>
                                <span class="font-medium">{dim.height}</span>
                              </span>
                              <span class="flex items-center gap-0.5 sm:gap-1">
                                <span class="text-slate-500">ks:</span>
                                <span class="font-medium">{dim.pieces}</span>
                              </span>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}

            <!-- Totals -->
            <div class="space-y-2 sm:space-y-3 pt-4 sm:pt-6 border-t border-slate-700/50 text-sm sm:text-base">
              <div class="flex justify-between text-slate-400">
                <span>Medzis√∫ƒçet bez DPH</span>
                <span class="text-white">{subtotal.toLocaleString('sk-SK', { minimumFractionDigits: 2 })} ‚Ç¨</span>
              </div>
              <div class="flex justify-between text-slate-400">
                <span>DPH {vatRate}%</span>
                <span class="text-white">{vatAmount.toLocaleString('sk-SK', { minimumFractionDigits: 2 })} ‚Ç¨</span>
              </div>
              <div class="flex justify-between text-lg sm:text-xl font-bold text-white pt-2 sm:pt-3 border-t border-slate-700/30">
                <span>Celkom s DPH</span>
                <span class="text-emerald-400">{totalWithVat.toLocaleString('sk-SK', { minimumFractionDigits: 2 })} ‚Ç¨</span>
              </div>
            </div>

            <!-- Final price highlight -->
            <div class="mt-6 sm:mt-8 p-4 sm:p-6 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-xl sm:rounded-2xl border border-emerald-500/20 text-center">
              <div class="text-xs sm:text-sm text-slate-400 mb-1 sm:mb-2">Va≈°a cena</div>
              <div class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-0.5 sm:mb-1">
                {totalWithVat.toLocaleString('sk-SK', { minimumFractionDigits: 2 })} ‚Ç¨
              </div>
              <div class="text-xs sm:text-sm text-slate-400">vr√°tane DPH {vatRate}%</div>
              
              {order.plannedEndDate && (
                <div class="mt-3 sm:mt-4 inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-amber-500/20 rounded-full text-amber-400 text-xs sm:text-sm">
                  <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Ponuka plat√≠ do {formatDate(order.plannedEndDate)}
                </div>
              )}
            </div>
          </>
        )}
      </div>

      <!-- Communication History -->
      {communicationActivities.length > 0 && (
        <div class="glass rounded-2xl sm:rounded-3xl p-4 sm:p-6 mb-6 animate-fade-in-up">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center">
              <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-white">Hist√≥ria komunik√°cie</h3>
          </div>
          <div class="space-y-3">
            {communicationActivities.map((activity) => {
              const isQuestion = activity.action === 'question_received' || activity.action === 'client_requested_changes';
              const isApproval = activity.action === 'client_approved';
              const isRejection = activity.action === 'client_rejected';
              
              return (
                <div class={`rounded-xl p-4 ${isQuestion ? 'bg-amber-500/10 border border-amber-500/20' : isApproval ? 'bg-emerald-500/10 border border-emerald-500/20' : 'bg-red-500/10 border border-red-500/20'}`}>
                  <div class="flex items-start gap-3">
                    <div class={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${isQuestion ? 'bg-amber-500/20' : isApproval ? 'bg-emerald-500/20' : 'bg-red-500/20'}`}>
                      {isQuestion ? (
                        <svg class="w-4 h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
                        </svg>
                      ) : isApproval ? (
                        <svg class="w-4 h-4 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                      ) : (
                        <svg class="w-4 h-4 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                      )}
                    </div>
                    <div class="flex-1 min-w-0">
                      <div class={`text-sm font-medium ${isQuestion ? 'text-amber-300' : isApproval ? 'text-emerald-300' : 'text-red-300'}`}>
                        {isQuestion ? 'Va≈°a ot√°zka' : isApproval ? 'Schv√°lili ste ponuku' : 'Zamietli ste ponuku'}
                      </div>
                      {activity.comment && (
                        <p class="text-slate-300 text-sm mt-1 whitespace-pre-wrap">"{activity.comment}"</p>
                      )}
                      <p class="text-slate-500 text-xs mt-2">
                        {format(activity.createdAt, 'd. MMM yyyy, HH:mm', { locale: sk })}
                      </p>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      )}

      <!-- Action buttons - hidden when waiting for client -->
      {!isWaitingForClient && (
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          {shareLink && (
            <a 
              href={`https://app.adsun.sk${shareLink}`}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-semibold rounded-xl transition-all shadow-lg shadow-emerald-600/20"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Zobrazi≈• detailn√∫ ponuku
            </a>
          )}
          <button 
            onclick="window.print()"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-xl transition-colors"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
            </svg>
            Vytlaƒçi≈• ponuku
          </button>
        </div>
      )}
    </div>
  </main>
</Layout>

<style>
  @media print {
    body {
      background: white !important;
      color: black !important;
    }
    .glass, .glass-light {
      background: white !important;
      border: 1px solid #ddd !important;
    }
    button, a[href="/dashboard"], a[href*="/order/"] {
      display: none !important;
    }
    header, footer {
      display: none !important;
    }
    .text-white {
      color: #1a1a1a !important;
    }
    .text-emerald-400 {
      color: #047857 !important;
    }
    .text-slate-400 {
      color: #666 !important;
    }
  }
</style>
