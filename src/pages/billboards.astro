---
import Layout from '../layouts/Layout.astro';
import { getSessionFromCookie } from '../lib/session';

// Check authentication
const session = getSessionFromCookie(Astro.request.headers.get('cookie'));

if (!session) {
  return Astro.redirect('/');
}

// TODO: Load billboards from database
const billboards: Array<{ id: string; code: string; location: string; city: string; status: string; startDate: string | null; endDate: string | null }> = [];

const stats = {
  total: billboards.length,
  rented: billboards.filter(b => b.status === 'rented').length,
  available: billboards.filter(b => b.status === 'available').length,
};
---

<Layout title="Moje billboardy" activeNav="billboards">
  <main class="min-h-screen pb-24 md:pb-8">
    <!-- Header -->
    <header class="px-6 py-8 md:px-8">
      <div class="max-w-6xl mx-auto">
        <!-- Breadcrumb -->
        <div class="flex items-center gap-2 text-sm text-[#6b7280] mb-6">
          <a href="/dashboard" class="hover:text-[#f59e0b] transition-colors flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Domov
          </a>
        </div>
        
        <!-- Title section -->
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
          <div>
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">
              <span class="text-gradient-orange">Moje</span> billboardy
            </h1>
            <p class="text-[#9ca3af]">
              Prehľad vašich prenajatých reklamných plôch
            </p>
          </div>
          
          <a href="tel:+421903222751" class="btn-adsun-primary inline-flex items-center gap-2 self-start">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            Mám záujem o ďalší
          </a>
        </div>
        
        <!-- Orange divider -->
        <hr class="divider-orange mt-6" />
      </div>
    </header>
    
    <div class="max-w-6xl mx-auto px-6 md:px-8">
      <!-- Stats Grid -->
      <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="adsun-card p-6 animate-fade-in-up">
          <div class="stats-number text-white mb-1">{stats.total}</div>
          <div class="text-[#6b7280] text-sm">Celkom</div>
        </div>
        <div class="adsun-card p-6 animate-fade-in-up stagger-1">
          <div class="stats-number stats-number-orange mb-1">{stats.rented}</div>
          <div class="text-[#6b7280] text-sm">Prenajaté</div>
        </div>
        <div class="adsun-card p-6 animate-fade-in-up stagger-2">
          <div class="stats-number stats-number-green mb-1">{stats.available}</div>
          <div class="text-[#6b7280] text-sm">Voľné</div>
        </div>
      </div>

      <!-- Billboards list -->
      {billboards.length === 0 ? (
        <div class="adsun-card p-12 text-center animate-fade-in-up">
          <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-[#1a1a1a] flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
              <line x1="8" y1="21" x2="16" y2="21"/>
              <line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-white mb-2">Zatiaľ žiadne billboardy</h2>
          <p class="text-[#6b7280] mb-6">Prenajmite si billboard a rozžiarte svoju reklamu!</p>
          <a href="tel:+421903222751" class="btn-adsun-primary inline-flex items-center gap-2">
            Mám záujem
          </a>
        </div>
      ) : (
        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {billboards.map((billboard, index) => (
            <div 
              class="adsun-card p-6 animate-fade-in-up"
              style={`animation-delay: ${index * 0.1}s`}
            >
              <!-- Billboard header -->
              <div class="flex items-start justify-between mb-4">
                <div>
                  <span class="font-mono text-sm text-[#f59e0b] font-medium">{billboard.code}</span>
                  <h3 class="text-lg font-semibold text-white mt-1">{billboard.location}</h3>
                </div>
                <span class:list={[
                  "px-2.5 py-1 rounded-md text-xs font-medium",
                  billboard.status === 'rented' ? "status-in-progress" : "status-completed"
                ]}>
                  {billboard.status === 'rented' ? 'Prenajatý' : 'Voľný'}
                </span>
              </div>
              
              <!-- Billboard info -->
              <div class="space-y-3 text-sm">
                <div class="flex items-center gap-2 text-[#9ca3af]">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                  {billboard.city}
                </div>
                
                {billboard.status === 'rented' && billboard.startDate && (
                  <div class="flex items-center gap-2 text-[#9ca3af]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                      <line x1="16" y1="2" x2="16" y2="6"/>
                      <line x1="8" y1="2" x2="8" y2="6"/>
                      <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span>
                      {new Date(billboard.startDate).toLocaleDateString('sk-SK')} - {new Date(billboard.endDate!).toLocaleDateString('sk-SK')}
                    </span>
                  </div>
                )}
              </div>
              
              <!-- Actions -->
              <div class="flex gap-2 mt-6">
                <button class="btn-adsun-secondary flex-1 text-sm py-2">
                  Zmeniť grafiku
                </button>
                <button class="btn-adsun-outline flex-1 text-sm py-2">
                  Detail
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
      
      <!-- CTA Section -->
      <div class="adsun-card adsun-card-active p-8 mt-8 text-center animate-fade-in-up">
        <h2 class="text-2xl font-bold text-white mb-2">
          Billboardy v okolí Pezinka – Vaša reklama na správnom mieste
        </h2>
        <p class="text-[#9ca3af] mb-6 max-w-2xl mx-auto">
          Strategicky umiestnené billboardy na hlavných dopravných trasách. 
          Kvalitné spracovanie a flexibilné riešenia.
        </p>
        <a href="https://adsun.sk/billboardy/" target="_blank" class="btn-adsun-primary inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
            <polyline points="15 3 21 3 21 9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
          Zobraziť všetky billboardy
        </a>
      </div>
    </div>
  </main>
</Layout>
